(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{45301:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(87916)}])},89949:function(e,t,n){"use strict";var a=n(85893),r=n(67294);t.Z=function(e){var t=e.children,n=e.isOpen,i=e.onClose,s=(0,r.useRef)(null),c=function(e){s.current&&!s.current.contains(e.target)&&i()};return(0,r.useEffect)((function(){return document.addEventListener("click",c,!0),function(){document.removeEventListener("click",c,!0)}}),[]),n?(0,a.jsx)("div",{className:"fixed top-0 left-0 w-full h-full bg-black/30 z-[10]",children:(0,a.jsx)("div",{ref:s,className:"fixed bg-white top-[50%] left-[50%] translate-x-[-50%] translate-y-[-50%] p-4 rounded-2xl",children:t})}):null}},86011:function(e,t,n){"use strict";var a=n(85893),r=(n(67294),n(56239));t.Z=function(e){var t=e.text;return(0,a.jsxs)("div",{className:"flex flex-row justify-center items-center",children:[(0,a.jsx)("div",{className:"w-5 h-5 flex justify-center items-center rounded-full bg-teal-400 mr-2",children:(0,a.jsx)(r.MCw,{height:"15px",width:"15px",color:"white"})}),(0,a.jsx)("div",{className:"text-gray-400",children:t})]})}},84901:function(e,t,n){"use strict";n.d(t,{E:function(){return a},k:function(){return r}});var a=1024,r=700},57529:function(e,t,n){"use strict";n.d(t,{l$:function(){return M},GX:function(){return j},mA:function(){return N},$3:function(){return C},dr:function(){return k},jR:function(){return S}});var a=n(88767),r=n(34051),i=n.n(r),s=n(54897);function c(e,t,n,a,r,i,s){try{var c=e[i](s),o=c.value}catch(u){return void n(u)}c.done?t(o):Promise.resolve(o).then(a,r)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function s(e){c(i,a,r,s,o,"next",e)}function o(e){c(i,a,r,s,o,"throw",e)}s(void 0)}))}}var u="/api/chats",d="/api/messages",l="api/chats/setSettingsProperty",f="api/chats/setChatVisited",h="/api/chats/create",g=function(){var e=o(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.Nv)(s.ZP.get("".concat(u,"?showRemovedFriends=").concat(t))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=o(i().mark((function e(t,n,a){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.Nv)(s.ZP.get("".concat(d,"?chatId=").concat(t,"&offset=").concat(n,"&limit=").concat(a))));case 1:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),v=function(){var e=o(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.Nv)(s.ZP.post(d,{chatId:t,text:n})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),x=function(){var e=o(i().mark((function e(t,n,a){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.Nv)(s.ZP.post(l,{chatId:t,property:n,value:a})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),p=function(){var e=o(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.Nv)(s.ZP.post(f,{userId:t,chatId:n})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),w=function(){var e=o(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.Nv)(s.ZP.post(h,{userId:t})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=n(41809),b=n(39187),j=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=(0,a.useQueryClient)(),n=(0,b.xq)(),r=function(){return t.invalidateQueries("chats")},i=(0,a.useQuery)("chats",(function(){return g(e)}),{enabled:!!n}),s=i.data,c=i.isLoading,o=i.error;return{data:s,isLoading:c,error:o,invalidateChats:r}},N=function(e,t){var n=(0,a.useInfiniteQuery)(["messages",e],(function(n){var a=n.pageParam;return m(e,void 0===a?0:a,t)}),{enabled:!!e});return{data:n.data,fetchNextPage:n.fetchNextPage,isLoading:n.isLoading,error:n.error}},C=function(e,t){var n=(0,a.useQueryClient)(),r=(0,b.xq)(),i=(0,a.useMutation)((function(e){var t=e.chatId,n=e.text;return v(t,n)}),{onSuccess:function(t){var a=t.message;null===e||void 0===e||e(),y.Z.emit("chatMessageSent",a),n.invalidateQueries("chats")},onError:function(){null===t||void 0===t||t({user:r})}});return{mutate:i.mutate,isLoading:i.isLoading,error:i.error}},S=function(){var e=(0,a.useQueryClient)(),t=(0,a.useMutation)((function(e){var t=e.chatId,n=e.property,a=e.value;return x(t,n,a)}));return{mutate:t.mutate,mutateAsync:t.mutateAsync,isLoading:t.isLoading,error:t.error,invalidateChats:function(){return e.invalidateQueries("chats")}}},k=function(){var e=(0,a.useMutation)((function(e){var t=e.userId,n=e.chatId;return p(t,n)}));return{mutate:e.mutate,mutateAsync:e.mutateAsync,isLoading:e.isLoading,error:e.error}},M=function(){var e=(0,a.useMutation)((function(e){var t=e.userId;return w(t)}));return{mutate:e.mutate,mutateAsync:e.mutateAsync,isLoading:e.isLoading,error:e.error}}},582:function(e,t,n){"use strict";var a=n(67294),r=function(){try{return{width:window.innerWidth,height:window.innerHeight}}catch(e){return{width:0,height:0}}};t.Z=function(){var e=(0,a.useState)(r()),t=e[0],n=e[1];return(0,a.useEffect)((function(){var e=function(){n(r())};return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),t}},87916:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return X}});var a=n(85893),r=n(57529),i=n(39187),s=n(67294),c=n(30381),o=n.n(c),u=n(22632),d=n(2740),l=n(582),f=n(84901),h=function(e){var t,n=e.chat,r=e.selectedChat,i=e.setSelectedChat,s=(0,d.T)().isDark,c=n.friend,h=n.lastMessage,g=n.me,m=(0,u.b)().t,v=(0,l.Z)().width,x=h.senderId===g._id,p=o()(g.lastVisit).isSameOrAfter(o()(h.createdAt))||x;return(0,a.jsxs)("div",{"data-testid":"chat-item","data-cy":"chatItem",className:"relative h-22 cursor-pointer m-3 mb-0 p-4 pr-6 rounded-2xl \n        ".concat((null===r||void 0===r?void 0:r._id)===n._id?"".concat(s?"bg-gray-600":"bg-indigo-100"):""),onClick:function(){return i(n)},children:[(0,a.jsx)("div",{className:"".concat(s?"text-white":"text-gray-800"),children:"".concat(c.firstName," ").concat(c.lastName)}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between",children:[(0,a.jsx)("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap text-sm\n          ".concat("".concat(p?s?"text-gray-400":"text-gray-500":s?"text-indigo-300":"text-indigo-500")),children:x?h.text:h.textTranslated||h.text||m.chats.noMessagesYet}),v>f.k&&(0,a.jsx)("div",{className:"text-sm mx-1 text-gray-400 whitespace-nowrap",children:(t=h.createdAt,o()(t).isSame(o()(),"day")?o()(t).format("HH:mm"):o()(t).isSame(o()(),"year")?o()(t).format("MMM D"):o()(t).format("MMM DD, YYYY"))})]}),!p&&(0,a.jsx)("div",{className:"absolute right-3 top-[36px] rounded-full h-2 w-2 bg-indigo-500"})]})},g=(0,s.memo)(h,(function(e,t){return JSON.stringify(e.chat)===JSON.stringify(t.chat)&&JSON.stringify(e.selectedChat)===JSON.stringify(t.selectedChat)})),m=n(11163),v=function(e){var t=e.chats,n=e.selectedChat,r=e.setSelectedChat,i=(0,u.b)().t,s=(0,m.useRouter)();return(0,a.jsx)("div",{className:"flex flex-col h-full w-full overflow-y-scroll",children:t.length>0?t.map((function(e){return(0,a.jsx)(g,{chat:e,selectedChat:n,setSelectedChat:r},e._id)})):(0,a.jsxs)("div",{className:"flex flex-col m-4 text-gray-500 items-center text-center",children:[i.chats.emptyChatList,(0,a.jsx)("div",{className:"flex cursor-pointer bg-indigo-500 text-white p-2 rounded-3xl w-32 items-center justify-center mt-4",onClick:function(){return s.push("/friends?addNewFriend")},children:i.chats.addFriend})]})})},x={selectedChat:null,setSelectedChat:function(){}},p=(0,s.createContext)(x),w=function(){return(0,s.useContext)(p)},y=function(e){var t=e.children,n=(0,s.useState)(null),r=n[0],i=n[1];return(0,a.jsx)(p.Provider,{value:{selectedChat:r,setSelectedChat:i},children:t})},b=function(e){var t=e.chats,n=e.isLoadingChats,r=(0,d.T)().isDark,i=w(),c=i.selectedChat,o=i.setSelectedChat;(0,s.useEffect)((function(){n||c||!t[0]||o(t[0]),u()}),[t]);var u=function(){var e=t.find((function(e){return e._id===(null===c||void 0===c?void 0:c._id)}));if(c&&e){var n=c.me,a=e.me,r=c.friend,i=e.friend;(a.sendLanguage!==n.sendLanguage||a.receiveLanguage!==n.receiveLanguage||a.showOriginalMessages!==n.showOriginalMessages||i.sendLanguage!==r.sendLanguage||i.receiveLanguage!==r.receiveLanguage||i.lastVisit!==r.lastVisit)&&e&&o(e)}};return(0,a.jsx)("div",{className:"flex h-full w-[25%] ".concat(r?"bg-gray-700 border-gray-600":"bg-gray-100"," border-r"),children:!n&&(0,a.jsx)(v,{chats:t,selectedChat:c,setSelectedChat:o})})},j=n(34051),N=n.n(j),C=n(56239),S=n(47010),k=function(e){var t=e.message,n=t.text,r=t.textTranslated,s=t.senderId,c=t.createdAt,u=e.showDateSeparator,l=e.nextMessageDate,f=e.isRead,h=e.showOriginalMessages,g=e.isPendingMessage,m=(0,d.T)().isDark,v=(0,i.xq)(),x=s===(null===v||void 0===v?void 0:v._id);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{"data-testid":"message-item",className:"flex flex-col \n          ".concat(x?"self-end bg-indigo-500":"self-start ".concat(m?"bg-gray-500":"bg-gray-200")," \n          mx-4 max-w-[50%] rounded-3xl px-4 pt-2 pb-1 break-words z-[1] mt-1 ").concat(g&&"bg-indigo-400"),children:[(0,a.jsx)("div",{className:"".concat(x||m?"text-white":"text-gray-800"),"data-cy":"translatedMessageText",children:function(){var e=x&&!h?n:r||n,t=(0,a.jsx)(S.Z,{color:"white",size:8});return g?t:e}()}),(0,a.jsxs)("div",{className:"flex flex-row items-center w-full ".concat(x?"justify-end":"justify-start"),children:[(0,a.jsx)("div",{className:"text-xs mr-1 ".concat(x?"text-gray-300":"text-gray-500"),children:o()(c).format("HH:mm")}),x&&(0,a.jsx)("div",{children:f?(0,a.jsx)(C.dIh,{height:"15px",width:"15px",color:"#2dd4bf"}):(0,a.jsx)(C.MCw,{height:"15px",width:"15px",color:"".concat(g?"#ccc":"#2dd4bf")})})]})]}),h&&(0,a.jsx)("div",{className:"flex flex-col \n          ".concat(x?"self-end ".concat(m?"bg-indigo-900 text-gray-200":"bg-indigo-200"," text-white"):"self-start ".concat(m?"bg-gray-800 text-gray-400":"bg-gray-100 text-gray-400")," \n          mx-4 max-w-[50%] rounded-3xl px-4 pt-2 pb-1 break-words mb-[-8px] pb-2 mt-2"),"data-cy":"originalMessageText",children:n}),u&&(0,a.jsxs)("div",{className:"flex flex-row w-full items-center py-8 px-12",children:[(0,a.jsx)("div",{className:"flex flex-1 h-[1px] ".concat(m?"bg-gray-500":"bg-gray-200")}),(0,a.jsx)("div",{className:"px-6 ".concat(m?"text-gray-300":"text-gray-500"," text-sm"),children:o()(l).format("MMM DD, YYYY")}),(0,a.jsx)("div",{className:"flex flex-1 h-[1px] ".concat(m?"bg-gray-500":"bg-gray-200")})]})]})},M=(0,s.memo)(k,(function(e,t){return JSON.stringify(e.message)===JSON.stringify(t.message)&&e.isRead===t.isRead&&e.showOriginalMessages===t.showOriginalMessages})),L=function(e){var t=e.messagesPages,n=e.friendLastVisit,r=e.fetchOlderMessages,i=e.isLastPageReached,s=e.showOriginalMessages,c=e.pendingMessage,d=(0,u.b)().t,l=!t[0][0];return(0,a.jsxs)("div",{className:"flex flex-col-reverse h-full w-full overflow-y-scroll py-4",children:[c,l?(0,a.jsx)("div",{className:"flex items-center justify-center mb-4 w-full text-gray-400 h-full",children:d.chats.noMessages}):null===t||void 0===t?void 0:t.map((function(e){return e.map((function(t,r){return(0,a.jsx)(M,{message:t,showDateSeparator:0!==r&&!o()(t.createdAt).isSame(e[r-1].createdAt,"day"),nextMessageDate:e[r-1]&&e[r-1].createdAt,isRead:!!n&&o()(n).isSameOrAfter(o()(t.createdAt)),showOriginalMessages:s},t._id)}))})),!i&&(0,a.jsx)("div",{className:"flex justify-center mb-4",onClick:r,children:(0,a.jsxs)("div",{className:"flex flex-row justify-center items-center bg-teal-400 text-white rounded-3xl px-4 py-2 cursor-pointer",children:[(0,a.jsx)(C.a2Z,{height:"15px",width:"15px",color:"white"}),(0,a.jsx)("div",{className:"pl-1 text-sm",children:d.messages.fetchOlder})]})})]})},E=n(88767),I=n(41809),_=n(40782),A=n(24926),Z=n(64487),O=function(e){var t=e.fetchNewestMessages,n=e.onMessageDispatched,i=e.isSendingMessagesDisabled,c=(0,d.T)().isDark,o=w().selectedChat,l=(0,s.useRef)(),f=(0,s.useState)(""),h=f[0],g=f[1],m=(0,s.useState)(!1),v=m[0],x=m[1],p=(0,u.b)().t,y=(0,r.$3)(t,(function(e){(0,_.Am)((0,a.jsx)(A.Z,{text:p.messages.messageNotSent})),Z.Tb({user:e.user,text:h,chatId:null===o||void 0===o?void 0:o._id})})).mutate;(0,s.useEffect)((function(){var e=document.activeElement===l.current;""!==h&&e&&!v&&x(!0),""===h&&v&&x(!1)}),[h,v]),(0,s.useEffect)((function(){o&&I.Z.emit(v?"startedTyping":"stoppedTyping",{chatId:o._id,friendId:o.friend._id})}),[v,o]);var b=function(){var e=null===o||void 0===o?void 0:o._id;e&&h&&!i&&(g(""),y({chatId:e,text:h}),n(h))};return(0,a.jsxs)("div",{className:"flex w-full ".concat(c?"bg-gray-600 border-gray-500":"white"," ml-2 mb-2 rounded-2xl border"),children:[(0,a.jsx)("textarea",{ref:l,className:"focus:outline-none w-full p-2 rounded-2xl h-[40px] resize-none ".concat(c?"bg-gray-600 text-white":"white"),value:h,onInput:function(e){"\n"!==e.target.value&&(g(e.target.value),l.current.style.height="",l.current.style.height=l.current.scrollHeight+"px")},onKeyDown:function(e){"Enter"!==e.key||e.shiftKey||(b(),l.current.style.height="")},onBlur:function(){return x(!1)},"data-cy":"messageTextarea"}),(0,a.jsx)("button",{className:"pr-4 ".concat(h?"cursor-pointer":"cursor-auto"),onClick:b,"data-cy":"sendMessageButton",children:(0,a.jsx)(C.vw7,{height:"20px",width:"20px",color:h&&!i?"#2dd4bf":"#d1d5db"})})]})},P=n(89949),T=[{name:"Afrikaans",code:"af"},{name:"Irish",code:"ga"},{name:"Albanian",code:"sq"},{name:"Italian",code:"it"},{name:"Arabic",code:"ar"},{name:"Japanese",code:"ja"},{name:"Azerbaijani",code:"az"},{name:"Kannada",code:"kn"},{name:"Basque",code:"eu"},{name:"Korean",code:"ko"},{name:"Bengali",code:"bn"},{name:"Latin",code:"la"},{name:"Belarusian",code:"be"},{name:"Latvian",code:"lv"},{name:"Bulgarian",code:"bg"},{name:"Lithuanian",code:"lt"},{name:"Catalan",code:"ca"},{name:"Macedonian",code:"mk"},{name:"Chinese Simplified",code:"zh-CN"},{name:"Malay",code:"ms"},{name:"Chinese Traditional",code:"zh-TW"},{name:"Maltese",code:"mt"},{name:"Croatian",code:"hr"},{name:"Norwegian",code:"no"},{name:"Czech",code:"cs"},{name:"Persian",code:"fa"},{name:"Danish",code:"da"},{name:"Polish",code:"pl"},{name:"Dutch",code:"nl"},{name:"Portuguese",code:"pt"},{name:"English",code:"en"},{name:"Romanian",code:"ro"},{name:"Esperanto",code:"eo"},{name:"Russian",code:"ru"},{name:"Estonian",code:"et"},{name:"Serbian",code:"sr-Latn"},{name:"Serbian Cyrillic",code:"sr"},{name:"Filipino",code:"tl"},{name:"Slovak",code:"sk"},{name:"Finnish",code:"fi"},{name:"Slovenian",code:"sl"},{name:"French",code:"fr"},{name:"Spanish",code:"es"},{name:"Galician",code:"gl"},{name:"Swahili",code:"sw"},{name:"Georgian",code:"ka"},{name:"Swedish",code:"sv"},{name:"German",code:"de"},{name:"Tamil",code:"ta"},{name:"Greek",code:"el"},{name:"Telugu",code:"te"},{name:"Gujarati",code:"gu"},{name:"Thai",code:"th"},{name:"Haitian Creole",code:"ht"},{name:"Turkish",code:"tr"},{name:"Hebrew",code:"iw"},{name:"Ukrainian",code:"uk"},{name:"Hindi",code:"hi"},{name:"Urdu",code:"ur"},{name:"Hungarian",code:"hu"},{name:"Vietnamese",code:"vi"},{name:"Icelandic",code:"is"},{name:"Welsh",code:"cy"},{name:"Indonesian",code:"id"},{name:"Yiddish",code:"yi"}];T.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}));var D,R=T.sort();!function(e){e.SEND_LANGUAGE="sendLanguage",e.RECEIVE_LANGUAGE="receiveLanguage",e.SHOW_ORIGINAL_MESSAGES="showOriginalMessages"}(D||(D={}));var F=n(86011),G=function(e){var t=e.isChecked,n=e.onChange;return(0,a.jsx)("div",{className:"relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in",children:(0,a.jsxs)("label",{className:"relative flex justify-between items-center group ml-[-16px] text-xl",children:[(0,a.jsx)("input",{checked:t,type:"checkbox",className:"absolute left-1/2 -translate-x-1/2 w-full h-full peer appearance-none rounded-md cursor-pointer",onClick:n}),(0,a.jsx)("span",{className:"w-12 h-6 flex items-center flex-shrink-0 ml-4 bg-gray-300 rounded-full duration-300 ease-in-out peer-checked:bg-teal-400 after:w-8 after:h-8 after:bg-white after:rounded-full after:shadow-md after:duration-300 peer-checked:after:translate-x-6 after:w-6 after:h-6 cursor-pointer"})]})})};function V(e,t,n,a,r,i,s){try{var c=e[i](s),o=c.value}catch(u){return void n(u)}c.done?t(o):Promise.resolve(o).then(a,r)}var q=function(e){var t=e.onApplyChanges,n=(0,u.b)().t,i=w().selectedChat,c=(0,r.jR)(),o=c.mutateAsync,d=c.invalidateChats,l=(0,s.useState)(""),f=l[0],h=l[1],g=(0,s.useState)(!1),m=g[0],v=g[1],x=(0,s.useState)(!1),p=x[0],y=x[1],b=(0,s.useState)(!1),j=b[0],C=b[1];(0,s.useEffect)((function(){(null===i||void 0===i?void 0:i.me.sendLanguage)&&h(i.me.sendLanguage),(null===i||void 0===i?void 0:i.me.showOriginalMessages)&&y(null===i||void 0===i?void 0:i.me.showOriginalMessages),C(!0)}),[i]);var k,M,L=function(){var e,r=(e=N().mark((function e(){return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i&&f){e.next=2;break}return e.abrupt("return");case 2:return v(!0),e.next=5,o({chatId:i._id,property:D.SEND_LANGUAGE,value:f});case 5:return e.next=7,o({chatId:i._id,property:D.RECEIVE_LANGUAGE,value:f});case 7:return e.next=9,o({chatId:i._id,property:D.SHOW_ORIGINAL_MESSAGES,value:p});case 9:return e.next=11,d();case 11:I.Z.emit("chatSettingChanged",i),(0,_.Am)((0,a.jsx)(F.Z,{text:n.chats.settings.settingsSuccessfullyChanged})),v(!1),t();case 15:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function s(e){V(i,a,r,s,c,"next",e)}function c(e){V(i,a,r,s,c,"throw",e)}s(void 0)}))});return function(){return r.apply(this,arguments)}}(),E=!!f&&(null===i||void 0===i?void 0:i.me.sendLanguage)!==f,A=(null===i||void 0===i?void 0:i.me.showOriginalMessages)!==p,Z=E||A,O=(null===i||void 0===i?void 0:i.friend.sendLanguage)||n.chats.settings.languageNotSelected;return j?(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("div",{className:"flex items-center justify-center h-8 w-full mb-10 text-indigo-500",children:n.chats.chatWith("".concat(null===i||void 0===i?void 0:i.friend.firstName," ").concat(null===i||void 0===i?void 0:i.friend.lastName))}),(0,a.jsxs)("div",{className:"flex flex-row mb-6",children:[(0,a.jsxs)("div",{className:"text-gray-500 w-60",children:[n.chats.settings.myLanguage,":"]}),(k=f,M=h,(0,a.jsxs)("select",{className:"outline-0 cursor-pointer",value:k,onChange:function(e){return M(e.target.value)},"data-cy":"selectLanguageDropdown",children:[(0,a.jsx)("option",{className:"hidden",children:n.chats.selectLanguage}),R.map((function(e){return(0,a.jsx)("option",{value:e.code,children:e.name},e.code)}))]}))]}),(0,a.jsxs)("div",{className:"flex flex-row mb-6",children:[(0,a.jsxs)("div",{className:"text-gray-500 w-60",children:[n.chats.settings.friendsLanguage,":"]}),(0,a.jsx)("div",{className:"pl-1",children:O})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center",children:[(0,a.jsxs)("div",{className:"text-gray-500 w-60",children:[n.chats.settings.showOriginalMessages,":"]}),(0,a.jsx)(G,{isChecked:p,onChange:function(){return y((function(e){return!e}))}})]}),(0,a.jsx)("div",{className:"flex items-center justify-center mt-12",children:(0,a.jsx)("div",{className:"\n          px-6 py-2 rounded-xl text-white \n          ".concat(Z&&!m?"bg-teal-400 cursor-pointer":"bg-gray-300 cursor-default"),onClick:function(){return Z&&!m&&L()},"data-cy":"applySettingsButton",children:m?(0,a.jsx)(S.Z,{color:"#808080",size:10}):n.chats.apply})})]}):(0,a.jsx)("div",{className:"w-[430.5px] h-[312px] bg-white"})},z=n(10080),H=function(){return"undefined"!==typeof document&&document.hasFocus()},Y=function(){var e=(0,s.useState)(H),t=e[0],n=e[1];return(0,s.useEffect)((function(){n(H());var e=function(){return n(!0)},t=function(){return n(!1)},a=function(){var e="visible"===document.visibilityState;n(e)};return window.addEventListener("focus",e),window.addEventListener("blur",t),window.addEventListener("visibilitychange",a),function(){window.removeEventListener("focus",e),window.removeEventListener("blur",t),window.addEventListener("visibilitychange",a)}}),[]),t};function Q(e,t,n,a,r,i,s){try{var c=e[i](s),o=c.value}catch(u){return void n(u)}c.done?t(o):Promise.resolve(o).then(a,r)}function B(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function s(e){Q(i,a,r,s,c,"next",e)}function c(e){Q(i,a,r,s,c,"throw",e)}s(void 0)}))}}var J=function(e){var t=e.invalidateChats,n=(0,d.T)().isDark,c=(0,E.useQueryClient)(),l=w().selectedChat,f=l?l._id:"",h=(0,i.xq)(),g=(0,u.b)().t,m=Y(),v=(0,s.useState)(1),x=v[0],p=v[1],y=(0,s.useState)(!1),b=y[0],j=y[1],S=(0,s.useState)(!1),k=S[0],_=S[1],A=(0,s.useState)(!1),Z=A[0],T=A[1],D=(0,s.useState)(null),R=D[0],F=D[1],G=(0,r.mA)(f,100),V=G.data,H=G.fetchNextPage,Q=G.isLoading,J=(0,s.useRef)(),U=(0,r.dr)().mutateAsync;(0,s.useEffect)((function(){if(T(!1),l&&h)return I.Z.on(z.C.friendStartedTyping,K),I.Z.on(z.C.friendStoppedTyping,X),ae(!0),l.me.sendLanguage||_(!0),function(){$(),I.Z.off(z.C.friendStartedTyping,K),I.Z.off(z.C.friendStoppedTyping,X)}}),[f]),(0,s.useEffect)((function(){return I.Z.on(z.C.loadMessage,W),function(){I.Z.off(z.C.loadMessage,W)}}),[f,m]),(0,s.useEffect)((function(){J.current=V,ee()}),[V]),(0,s.useEffect)((function(){m&&document.title.includes("(".concat(g.messages.new,")"))&&(document.title=g.general.title)}),[m]);var W=function(){var e=B(N().mark((function e(n){return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m||(document.title="".concat(g.general.title," (").concat(g.messages.new,")")),n.chatId!==f){e.next=5;break}return ne(),e.next=5,ae();case 5:t();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),K=function(e){e.chatId===(null===l||void 0===l?void 0:l._id)&&T(!0)},X=function(e){e.chatId===(null===l||void 0===l?void 0:l._id)&&T(!1)},$=function(){p(1),c.removeQueries(["messages",f])},ee=function(){var e=null===V||void 0===V?void 0:V.pages;e&&e[e.length-1].length<100?j(!0):b&&j(!1)},te=function(){var e=B(N().mark((function e(){return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H({pageParam:x});case 2:p(x+1);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ne=function(){var e=B(N().mark((function e(){return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.setQueryData(["messages",f],(function(){var e;return{pages:[null===(e=J.current)||void 0===e?void 0:e.pages[0]],pageParams:[void 0]}})),e.next=3,c.refetchQueries(["messages",f]);case 3:p(1),F(null);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=B(N().mark((function e(){var n,a,r,i=arguments;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>0&&void 0!==i[0]&&i[0],h&&l){e.next=3;break}return e.abrupt("return");case 3:return a=h._id,r=l._id,e.next=7,U({userId:a,chatId:r});case 7:if(!n){e.next=10;break}return e.next=10,t();case 10:I.Z.emit("friendVisitedChat",{userId:a,chatId:r});case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),re=!Q&&l;if(!l)return(0,a.jsx)("div",{className:"flex items-center justify-center w-full text-gray-400 ".concat(n?"bg-gray-700":"bg-gray-50"),children:g.chats.chatWillAppear});return(0,a.jsxs)("div",{className:"flex flex-1 flex-col h-full ".concat(n?"bg-gray-700":"bg-gray-50"," overflow-auto"),children:[(0,a.jsx)(P.Z,{isOpen:k,onClose:function(){_(!1)},children:(0,a.jsx)(q,{onApplyChanges:function(){_(!1)}})}),re&&(null===V||void 0===V?void 0:V.pages)?(0,a.jsx)(L,{messagesPages:V.pages,friendLastVisit:l.friend.lastVisit,fetchOlderMessages:te,isLastPageReached:b,showOriginalMessages:l.me.showOriginalMessages,pendingMessage:R?(0,a.jsx)(M,{message:{_id:"pending",chatId:f,text:R||"",textTranslated:"",senderId:(null===h||void 0===h?void 0:h._id)||"",receiverId:"",createdAt:o()().format("YYYY-MM-DDTHH:mm:ss.SSSZ")},showDateSeparator:!1,isRead:!1,showOriginalMessages:l.me.showOriginalMessages,isPendingMessage:!0},"pending"):null}):(0,a.jsx)("div",{className:"flex flex-col-reverse h-full w-full overflow-y-scroll"}),Z&&(0,a.jsx)("div",{className:"m-2 ml-4 text-gray-400 italic",children:g.chats.friendTyping}),(0,a.jsxs)("div",{className:"flex flex-row",children:[(0,a.jsx)(O,{fetchNewestMessages:ne,onMessageDispatched:function(e){F(e)},isSendingMessagesDisabled:!!R}),(0,a.jsx)("div",{className:"m-4 mt-2 cursor-pointer",onClick:function(){_(!0)},"data-cy":"settingsIcon",children:(0,a.jsx)(C.a9L,{height:"24px",width:"24px",color:n?"#ccc":"#6366f1"})})]})]})},U=n(10234),W=n(34840),K=n(72364),X=function(){var e=(0,i.xq)(),t=(0,u.b)().t,n=Y(),c=(0,r.GX)(),o=c.data,d=void 0===o?[]:o,l=c.isLoading,f=c.invalidateChats;(0,s.useEffect)((function(){I.Z.on(z.C.connect,(function(){e&&I.Z.emit("createUserSession",{userId:e._id,socketId:I.Z.id})}))}),[e]),(0,s.useEffect)((function(){return(0,U.c)(),I.Z.on(z.C.loadChatSettings,f),I.Z.on(z.C.updateFriendVisitData,f),I.Z.on(z.C.newFriendRequest,g),function(){I.Z.off(z.C.loadChatSettings,f),I.Z.off(z.C.updateFriendVisitData,f),I.Z.off(z.C.newFriendRequest,g)}}),[]),(0,s.useEffect)((function(){return h(),(0,U.c)(),I.Z.on(z.C.newFriendRequest,g),function(){I.Z.off(z.C.newFriendRequest,g)}}),[n]);var h=function(){W.S({dsn:"https://669c4997b53640bf872df8d2746db81c@o4504026921566208.ingest.sentry.io/4504026924056576",integrations:[new K.gE],tracesSampleRate:1})},g=function(){n||(document.title="".concat(t.general.title," (").concat(t.friends.newFriendRequest,")"))};return(0,a.jsx)("div",{className:"h-screen","data-cy":"homeScreen",children:(0,a.jsx)(y,{children:(0,a.jsxs)("div",{className:"flex flex-row h-[92%]",children:[(0,a.jsx)(b,{chats:d,isLoadingChats:l}),(0,a.jsx)(J,{invalidateChats:f})]})})})}},54897:function(e,t,n){"use strict";n.d(t,{v3:function(){return o},Nv:function(){return l}});var a=n(34051),r=n.n(a),i=n(9669),s=n.n(i);function c(e,t,n,a,r,i,s){try{var c=e[i](s),o=c.value}catch(u){return void n(u)}c.done?t(o):Promise.resolve(o).then(a,r)}var o="http://46.101.119.178:5000",u={baseURL:o||"",responseType:"json"},d=function(e,t){Object.keys(t).forEach((function(n){e.defaults.headers[n]=t[n]}))},l=function(){var e,t=(e=r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:return n=e.sent.data,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function s(e){c(i,a,r,s,o,"next",e)}function o(e){c(i,a,r,s,o,"throw",e)}s(void 0)}))});return function(e){return t.apply(this,arguments)}}();t.ZP=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,t=s().create(e),n=localStorage.getItem("user"),a=n?JSON.parse(n).token:null,r={accept:"application/json",authorization:""};return a&&(r.authorization=a),d(t,r),t}()},41809:function(e,t,n){"use strict";var a=n(86809),r=n.n(a),i=n(54897),s=r()(i.v3,{transports:["websocket"]});t.Z=s},10080:function(e,t,n){"use strict";var a;n.d(t,{C:function(){return a}}),function(e){e.connect="connect",e.loadChatSettings="loadChatSettings",e.updateFriendVisitData="updateFriendVisitData",e.loadMessage="loadMessage",e.friendStartedTyping="friendStartedTyping",e.friendStoppedTyping="friendStoppedTyping",e.newFriendRequest="newFriendRequest"}(a||(a={}))},10234:function(e,t,n){"use strict";n.d(t,{c:function(){return r}});var a=n(40782),r=(n(40993),function(){a.Am.configure({autoClose:2e3,hideProgressBar:!0,closeOnClick:!0,closeButton:!1})})},77020:function(){}},function(e){e.O(0,[885,669,393,266,774,888,179],(function(){return t=45301,e(e.s=t);var t}));var t=e.O();_N_E=t}]);