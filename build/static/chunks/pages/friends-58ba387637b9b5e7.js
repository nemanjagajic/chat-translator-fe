(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[128],{51208:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/friends",function(){return n(22888)}])},89949:function(e,t,n){"use strict";var r=n(85893),i=n(67294);t.Z=function(e){var t=e.children,n=e.isOpen,s=e.onClose,u=(0,i.useRef)(null),a=function(e){u.current&&!u.current.contains(e.target)&&s()};return(0,i.useEffect)((function(){return document.addEventListener("click",a,!0),function(){document.removeEventListener("click",a,!0)}}),[]),n?(0,r.jsx)("div",{className:"fixed top-0 left-0 w-full h-full bg-black/30 z-[10]",children:(0,r.jsx)("div",{ref:u,className:"fixed bg-white top-[50%] left-[50%] translate-x-[-50%] translate-y-[-50%] p-4 rounded-2xl",children:t})}):null}},86011:function(e,t,n){"use strict";var r=n(85893),i=(n(67294),n(56239));t.Z=function(e){var t=e.text;return(0,r.jsxs)("div",{className:"flex flex-row justify-center items-center",children:[(0,r.jsx)("div",{className:"w-5 h-5 flex justify-center items-center rounded-full bg-teal-400 mr-2",children:(0,r.jsx)(i.MCw,{height:"15px",width:"15px",color:"white"})}),(0,r.jsx)("div",{className:"text-gray-400",children:t})]})}},57529:function(e,t,n){"use strict";n.d(t,{l$:function(){return S},GX:function(){return N},mA:function(){return b},$3:function(){return R},dr:function(){return F},jR:function(){return q}});var r=n(88767),i=n(34051),s=n.n(i),u=n(54897);function a(e,t,n,r,i,s,u){try{var a=e[s](u),c=a.value}catch(o){return void n(o)}a.done?t(c):Promise.resolve(c).then(r,i)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function u(e){a(s,r,i,u,c,"next",e)}function c(e){a(s,r,i,u,c,"throw",e)}u(void 0)}))}}var o="/api/chats",d="/api/messages",f="api/chats/setSettingsProperty",l="api/chats/setChatVisited",v="/api/chats/create",h=function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.Nv)(u.ZP.get("".concat(o,"?showRemovedFriends=").concat(t))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=c(s().mark((function e(t,n,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.Nv)(u.ZP.get("".concat(d,"?chatId=").concat(t,"&offset=").concat(n,"&limit=").concat(r))));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),m=function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.Nv)(u.ZP.post(d,{chatId:t,text:n})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),x=function(){var e=c(s().mark((function e(t,n,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.Nv)(u.ZP.post(f,{chatId:t,property:n,value:r})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),g=function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.Nv)(u.ZP.post(l,{userId:t,chatId:n})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),y=function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.Nv)(u.ZP.post(v,{userId:t})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=n(41809),j=n(39187),N=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=(0,r.useQueryClient)(),n=(0,j.xq)(),i=function(){return t.invalidateQueries("chats")},s=(0,r.useQuery)("chats",(function(){return h(e)}),{enabled:!!n}),u=s.data,a=s.isLoading,c=s.error;return{data:u,isLoading:a,error:c,invalidateChats:i}},b=function(e,t){var n=(0,r.useInfiniteQuery)(["messages",e],(function(n){var r=n.pageParam;return p(e,void 0===r?0:r,t)}),{enabled:!!e});return{data:n.data,fetchNextPage:n.fetchNextPage,isLoading:n.isLoading,error:n.error}},R=function(e,t){var n=(0,r.useQueryClient)(),i=(0,j.xq)(),s=(0,r.useMutation)((function(e){var t=e.chatId,n=e.text;return m(t,n)}),{onSuccess:function(t){var r=t.message;w.Z.emit("chatMessageSent",r),null===e||void 0===e||e(),n.invalidateQueries("chats")},onError:function(){null===t||void 0===t||t({user:i})}});return{mutate:s.mutate,isLoading:s.isLoading,error:s.error}},q=function(){var e=(0,r.useQueryClient)(),t=(0,r.useMutation)((function(e){var t=e.chatId,n=e.property,r=e.value;return x(t,n,r)}));return{mutate:t.mutate,mutateAsync:t.mutateAsync,isLoading:t.isLoading,error:t.error,invalidateChats:function(){return e.invalidateQueries("chats")}}},F=function(){var e=(0,r.useMutation)((function(e){var t=e.userId,n=e.chatId;return g(t,n)}));return{mutate:e.mutate,mutateAsync:e.mutateAsync,isLoading:e.isLoading,error:e.error}},S=function(){var e=(0,r.useMutation)((function(e){var t=e.userId;return y(t)}));return{mutate:e.mutate,mutateAsync:e.mutateAsync,isLoading:e.isLoading,error:e.error}}},22888:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return X}});var r,i=n(85893),s=n(67294);!function(e){e.myFriends="myFriends",e.receivedRequests="receivedRequests",e.sentRequests="sentRequests",e.addNewFriend="addNewFriend"}(r||(r={}));var u=n(88767),a=n(34051),c=n.n(a),o=n(54897);function d(e,t,n,r,i,s,u){try{var a=e[s](u),c=a.value}catch(o){return void n(o)}a.done?t(c):Promise.resolve(c).then(r,i)}function f(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function u(e){d(s,r,i,u,a,"next",e)}function a(e){d(s,r,i,u,a,"throw",e)}u(void 0)}))}}var l="/api/friends",v="/api/friends/searchUser",h="/api/friends/sendFriendRequest",p="/api/friends/respondToFriendRequest",m="/api/friends/remove",x=function(){var e=f(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.Nv)(o.ZP.get(l)));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g=function(){var e=f(c().mark((function e(t,n,r){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.Nv)(o.ZP.get("".concat(v,"?text=").concat(t,"&offset=").concat(n,"&limit=").concat(r))));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),y=function(){var e=f(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.Nv)(o.ZP.post(h,{userId:t})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=f(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.Nv)(o.ZP.post(p,{userId:t,accept:n})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),j=function(){var e=f(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.Nv)(o.ZP.delete(m,{data:{userId:t}})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=n(39187),b=function(e,t){var n=(0,u.useQueryClient)(),r=(0,N.xq)(),i=(0,u.useMutation)((function(e){var t=e.userId;return y(t)}),{onSuccess:function(){null===e||void 0===e||e(),n.invalidateQueries("friends")},onError:function(){null===t||void 0===t||t({user:r})}});return{mutate:i.mutate,isLoading:i.isLoading,error:i.error}},R=function(e){var t=(0,u.useQueryClient)(),n=(0,u.useMutation)((function(e){var t=e.userId,n=e.accept;return w(t,n)}),{onSuccess:function(){null===e||void 0===e||e(),t.invalidateQueries("friends")}});return{mutate:n.mutate,isLoading:n.isLoading,error:n.error}},q=function(e){var t=(0,u.useQueryClient)(),n=(0,u.useMutation)((function(e){var t=e.userId;return j(t)}),{onSuccess:function(){null===e||void 0===e||e(),t.invalidateQueries("friends")}});return{mutate:n.mutate,isLoading:n.isLoading,error:n.error}},F=n(40782),S=n(86011),I=n(22632),k=n(2740),L=n(41809),C=n(56239),P=n(64487),M=n(24926),T=function(e){var t=e.friend,n=t._id,r=t.firstName,s=t.lastName,u=t.email,a=e.isSearchList,c=void 0!==a&&a,o=e.status,d=e.setIsSettingsModalOpen,f=e.setActiveFriendIdToDelete,l=(0,k.T)().isDark,v=(0,I.b)().t,h=b((function(){L.Z.emit("friendSentRequest",n),(0,F.Am)((0,i.jsx)(S.Z,{text:v.friends.successfullySentFriendRequest}))}),(function(e){(0,F.Am)((0,i.jsx)(M.Z,{text:v.friends.failedToAddFriend})),P.Tb({user:e.user,userId:n})})).mutate;return(0,i.jsxs)("div",{className:"flex flex-row ".concat(l?"bg-gray-300":"bg-gray-100"," w-96 my-4 mt-6 p-4 \n    rounded-xl drop-shadow-sm justify-between items-center"),"data-cy":"friendItem",children:[(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsx)("div",{className:"text-gray-800",children:"".concat(r," ").concat(s)}),(0,i.jsx)("div",{className:"text-sm text-gray-500",children:u})]}),c?function(){if(!o)return null;var e=o.isMe,t=o.isFriend,r=o.isRequestReceived,s=o.isRequestSent,u=function(){},a="bg-gray-400",c="",d="cursor-default";return e&&(c=v.friends.friendStatus.me),t&&(c=v.friends.friendStatus.friend),s&&(c=v.friends.friendStatus.requestSent),r&&(c=v.friends.friendStatus.requestReceived),e||t||s||r||(u=function(){return h({userId:n})},a="bg-teal-400",c=v.friends.sendRequest,d="cursor-pointer"),(0,i.jsx)("div",{onClick:u,className:"".concat(a," text-white py-1 px-3 rounded-2xl ").concat(d),children:c})}():(0,i.jsx)("div",{onClick:function(){null===d||void 0===d||d(!0),null===f||void 0===f||f(n)},className:"flex items-center justify-center bg-red-400 w-10 h-10 rounded-full cursor-pointer mx-2 my-1",children:(0,i.jsx)(C.x8P,{height:"20px",width:"15px",color:"#ffffff"})})]})},_=function(e){var t=e.friends,n=e.isSearchList,r=void 0!==n&&n,s=e.isRefetching,u=void 0!==s&&s,a=e.allFriends,c=e.setIsSettingsModalOpen,o=e.setActiveFriendIdToDelete,d=(0,I.b)().t,f=(0,N.xq)();if(!t)return null;if(!r&&0===t.length&&!u)return(0,i.jsx)("div",{className:"text-gray-400 mt-8",children:d.friends.friendListEmpty});if(r&&0===t.length&&!u)return(0,i.jsx)("div",{className:"text-gray-400 mt-8",children:d.friends.noUsersMatchingSearch});var l=function(e){return{isMe:e._id===(null===f||void 0===f?void 0:f._id),isFriend:!!(null===a||void 0===a?void 0:a.friends.find((function(t){return t._id===e._id}))),isRequestSent:!!(null===a||void 0===a?void 0:a.friendRequests.find((function(t){return t._id===e._id&&t.requestedByMe}))),isRequestReceived:!!(null===a||void 0===a?void 0:a.friendRequests.find((function(t){return t._id===e._id&&!t.requestedByMe})))}};return(0,i.jsx)("div",{children:t.map((function(e){return(0,i.jsx)(T,{friend:e,isSearchList:r,status:r?l(e):null,setIsSettingsModalOpen:c,setActiveFriendIdToDelete:o},e._id)}))})},Z=n(57529),E=function(e){var t=e.friendRequest,n=t._id,r=t.firstName,s=t.lastName,u=t.email,a=t.requestedByMe,c=void 0!==a&&a,o=e.chats,d=(0,k.T)().isDark,f=(0,I.b)().t,l=(0,Z.l$)().mutate,v=R((function(){(0,F.Am)((0,i.jsx)(S.Z,{text:f.friends.successfullyRespondedToRequest})),(null===o||void 0===o?void 0:o.find((function(e){return console.log({first:e.friend._id,second:n}),e.friend._id===n})))||l({userId:n})})).mutate;return(0,i.jsxs)("div",{className:"flex flex-row ".concat(d?"bg-gray-300":"bg-gray-100"," \n    w-96 my-4 mt-6 p-4 rounded-xl drop-shadow-sm justify-between"),children:[(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsx)("div",{className:"text-gray-800",children:"".concat(r," ").concat(s)}),(0,i.jsx)("div",{className:"text-sm text-gray-500",children:u})]}),!c&&(0,i.jsxs)("div",{className:"flex flex-row",children:[(0,i.jsx)("div",{onClick:function(){return v({userId:n,accept:!0})},className:"flex items-center justify-center bg-teal-400 w-10 h-10 rounded-full cursor-pointer mx-2",children:(0,i.jsx)(C.MCw,{height:"20px",width:"15px",color:"#ffffff"})}),(0,i.jsx)("div",{onClick:function(){return v({userId:n,accept:!1})},className:"flex items-center justify-center bg-red-400 w-10 h-10 rounded-full cursor-pointer mx-2",children:(0,i.jsx)(C.x8P,{height:"20px",width:"15px",color:"#ffffff"})})]})]})},A=function(e){var t=e.friendsRequests,n=e.chats,r=(0,I.b)().t;return t?0===t.length?(0,i.jsx)("div",{className:"text-gray-400 mt-8",children:r.friends.requestListIsEmpty}):(0,i.jsx)("div",{children:t.map((function(e){return(0,i.jsx)(E,{friendRequest:e,chats:n},e._id)}))}):null};var Q=n(10234),O=n(11163),D=n(10080),B=n(89949),z=function(){try{return{width:window.innerWidth,height:window.innerHeight}}catch(e){return{width:0,height:0}}},U=function(){var e=(0,s.useState)(z()),t=e[0],n=e[1];return(0,s.useEffect)((function(){var e=function(){n(z())};return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),t},X=function(){var e=(0,k.T)().isDark,t=(0,I.b)().t,n=(0,O.useRouter)(),a=(0,s.useState)(r.myFriends),c=a[0],o=a[1],d=(0,s.useState)(""),f=d[0],l=d[1],v=(0,s.useState)(!1),h=v[0],p=v[1],m=(0,s.useState)(""),y=m[0],w=m[1],j=function(e,t){var n=(0,s.useState)(e),r=n[0],i=n[1];return(0,s.useEffect)((function(){var n=setTimeout((function(){return i(e)}),t);return function(){return clearTimeout(n)}}),[e,t]),r}(f,500),N=U().width,b=function(){var e=(0,u.useQueryClient)(),t=(0,u.useQuery)("friends",x);return{data:t.data,isLoading:t.isLoading,error:t.error,invalidateFriends:function(){return e.invalidateQueries("friends")}}}(),R=b.data,C=b.invalidateFriends,P=function(e,t,n){var r=(0,u.useQuery)("searchUser",(function(){return g(e,t,n)}),{enabled:""!==e});return{data:r.data,isLoading:r.isLoading,error:r.error,refetch:r.refetch,isRefetching:r.isRefetching}}(j,0,10),M=P.data,T=P.refetch,E=P.isRefetching,z=(0,Z.GX)(!0).data,X=void 0===z?[]:z,V=q((function(){(0,F.Am)((0,i.jsx)(S.Z,{text:t.friends.friendRemoved})),p(!1)})).mutate;(0,s.useEffect)((function(){return(0,Q.c)(),L.Z.on(D.C.newFriendRequest,$),function(){L.Z.off(D.C.newFriendRequest,$)}}),[]),(0,s.useEffect)((function(){j&&T()}),[j]),(0,s.useEffect)((function(){var e=n.asPath;e==="/friends?".concat(r.myFriends)&&o(r.myFriends),e==="/friends?".concat(r.receivedRequests)&&o(r.receivedRequests),e==="/friends?".concat(r.sentRequests)&&o(r.sentRequests),e==="/friends?".concat(r.addNewFriend)&&o(r.addNewFriend)}),[n.asPath]);var $=function(){C()},G=function(e){return R?e===r.myFriends?R.friends.length:e===r.sentRequests?R.friendRequests.filter((function(e){return e.requestedByMe})).length:e===r.receivedRequests?R.friendRequests.filter((function(e){return!e.requestedByMe})).length:0:0},H=[{tab:r.myFriends,title:t.friends.tabTitles.myFriends},{tab:r.receivedRequests,title:N>1024?t.friends.tabTitles.receivedRequests:t.friends.tabTitles.received},{tab:r.sentRequests,title:N>1024?t.friends.tabTitles.sentRequests:t.friends.tabTitles.sent},{tab:r.addNewFriend,title:t.friends.tabTitles.addNewFriend}],W=null===R||void 0===R?void 0:R.friends,J=R&&R.friendRequests.filter((function(e){return!e.requestedByMe})),Y=R&&R.friendRequests.filter((function(e){return e.requestedByMe}));return(0,i.jsxs)("div",{className:"flex flex-col h-screen ".concat(e?"bg-gray-700":"bg-gray-50"," items-center"),children:[(0,i.jsx)("div",{className:"flex ".concat(N>700?"flex-row":"flex-col"," w-full pt-8 items-center justify-center"),children:H.map((function(e){return t=e.tab,s=e.title,(0,i.jsxs)("div",{className:"\n        flex flex-row px-4 py-3 mx-4 rounded-3xl cursor-pointer w-52 \n        justify-center items-center overflow-hidden whitespace-nowrap mt-2\n        ".concat(t===c?"bg-indigo-500 text-white":"text-gray-600 bg-gray-200"),onClick:function(){return n.push("/friends?".concat(t))},children:[(0,i.jsx)("div",{children:s}),t!==r.addNewFriend&&(0,i.jsx)("div",{className:"flex items-center justify-center bg-white text-gray-500 rounded-full px-2 ml-2 text-sm border",children:G(t)})]});var t,s}))}),R&&(0,i.jsxs)("div",{className:"flex flex-col items-center w-[1024px] mt-6 overflow-y-scroll mb-20",children:[c===r.myFriends&&W&&(0,i.jsx)(_,{friends:W,setIsSettingsModalOpen:p,setActiveFriendIdToDelete:w}),c===r.receivedRequests&&J&&(0,i.jsx)(A,{friendsRequests:J,chats:X}),c===r.sentRequests&&Y&&(0,i.jsx)(A,{friendsRequests:Y}),c===r.addNewFriend&&(0,i.jsxs)("div",{className:"w-full flex flex-col items-center",children:[(0,i.jsx)("input",{className:"w-80 focus:outline-none p-2 rounded-2xl h-[40px] resize-none border mt-6",onInput:function(e){l(e.target.value)},value:f,placeholder:t.friends.addFriendInputPlaceholder,"data-cy":"addFriendSearchInput"}),j&&M?(0,i.jsx)(_,{friends:M,isSearchList:!0,isRefetching:E,allFriends:R}):(0,i.jsx)("div",{className:"text-gray-400 mt-8",children:t.friends.searchResultsWillAppearHere})]})]}),(0,i.jsx)(B.Z,{isOpen:h,onClose:function(){p(!1),w("")},children:(0,i.jsxs)("div",{className:"my-4 mx-2",children:[(0,i.jsx)("div",{className:"text-gray-600",children:t.friends.areYouSureDeleteMessage}),(0,i.jsxs)("div",{className:"flex flex-row justify-center mt-6",children:[(0,i.jsx)("div",{className:"flex items-center justify-center w-16 h-8 bg-teal-400 rounded-xl cursor-pointer text-white mr-2",onClick:function(){return V({userId:y})},children:t.general.yes}),(0,i.jsx)("div",{className:"flex items-center justify-center w-16 h-8 bg-gray-300 rounded-xl cursor-pointer text-white ml-2",onClick:function(){p(!1),w("")},children:t.general.no})]})]})})]})}},54897:function(e,t,n){"use strict";n.d(t,{v3:function(){return c},Nv:function(){return f}});var r=n(34051),i=n.n(r),s=n(9669),u=n.n(s);function a(e,t,n,r,i,s,u){try{var a=e[s](u),c=a.value}catch(o){return void n(o)}a.done?t(c):Promise.resolve(c).then(r,i)}var c="http://localhost:8000",o={baseURL:c||"",responseType:"json"},d=function(e,t){Object.keys(t).forEach((function(n){e.defaults.headers[n]=t[n]}))},f=function(){var e,t=(e=i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:return n=e.sent.data,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function u(e){a(s,r,i,u,c,"next",e)}function c(e){a(s,r,i,u,c,"throw",e)}u(void 0)}))});return function(e){return t.apply(this,arguments)}}();t.ZP=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,t=u().create(e),n=localStorage.getItem("user"),r=n?JSON.parse(n).token:null,i={accept:"application/json",authorization:""};return r&&(i.authorization=r),d(t,i),t}()},41809:function(e,t,n){"use strict";var r=n(86809),i=n.n(r),s=n(54897),u=i()(s.v3,{transports:["websocket"]});t.Z=u},10080:function(e,t,n){"use strict";var r;n.d(t,{C:function(){return r}}),function(e){e.connect="connect",e.loadChatSettings="loadChatSettings",e.updateFriendVisitData="updateFriendVisitData",e.loadMessage="loadMessage",e.friendStartedTyping="friendStartedTyping",e.friendStoppedTyping="friendStoppedTyping",e.newFriendRequest="newFriendRequest"}(r||(r={}))},10234:function(e,t,n){"use strict";n.d(t,{c:function(){return i}});var r=n(40782),i=(n(40993),function(){r.Am.configure({autoClose:2e3,hideProgressBar:!0,closeOnClick:!0,closeButton:!1})})},77020:function(){}},function(e){e.O(0,[669,393,774,888,179],(function(){return t=51208,e(e.s=t);var t}));var t=e.O();_N_E=t}]);